---
title: Http缓存机制
---

# 基于缓存策略三要素分解法

## 缓存存储策略

- 用来确定 Http 响应内容是否可以被客户端缓存，以及可以被哪些客户端缓存

- Cache-Control 的值：设定是否被哪些设备缓存 Public、Private、no-cache、max-age 、no-store

---

## 缓存过期策略

- 客户端用来确认存储在本地的缓存数据是否已过期，进而决定是否要发请求到服务端获取数据

- Expires指定缓存数据的有效时间，有效时间后，本地缓存作废
		+ Cache-Control的值：no-cache和max-age，既包含缓存存储策略也包含缓存过期策略
		+ Cache-Control:no-cache和Cache-Control:max-age=0的效果是一样的
		+ no-cache不建议缓存，但是还是会缓存的

---

## 缓存对比策略

 - 缓存在客户端的数据标识发往服务端，服务端通过标识来判断客户端 缓存数据是否仍有效，进而决定是否要重发数据。
 
 - 客户端检测到数据过期或浏览器刷新之后，会重新发起一个http去请求，服务器会判断请求头有没有标识（If-Modified-Since、If-None-Match），标识有效，就返回304客户端读取本队缓存数据【必须要在首次响应时输出相应的头信息Last-Modified、ETags到客户端】
	
### 在浏览器没有提供缓存过期策略的时候，遵循一个启发式缓存过期策略

- 在响应头中2个事件字段Date和Last-Modified之间的时间插值取10%作为缓存时间周期
	
[more](http://mp.weixin.qq.com/s/qOMO0LIdA47j3RjhbCWUEQ?utm_source=caibaojian.com)

### http协议的主要特点：
- 简单快速：统一资源符是固定的的
- 灵活：通过一个协议完成不同类型的传输
- 无连接：连接一次就会断掉
- 无状态：服务端无法记住两次连接的状态，会断掉

### http报文组成部分
- 请求报文： 请求行[http方法，页面地址，http协议及版本] 请求头[key value需要什么内容版本] 空行 请求体
- 响应报文： 状态行 响应头 空行 响应体

### http方法
- get
- post
- put
- delete
- head
- get和post的区别
 + get在浏览器回退时是无害的，但post会再次提交请求
 + get请求会被浏览器主动缓存，但post不会，除非手动设置
 + get请求在url中传送的参数室友长度限制的，而post没有限时
 + get请求参数会被完整保留在浏览器历史记录中，但post参数不会被保留
 + get比post更不安全，参数暴露在url上，不能用来传递敏感信息
 + get参数通过url传递，post放在request body中

### http状态码
- 1xx:指示信息-表示请求已接收，继续处理
- 2xx:成功-表示请求已被成功接收
- 3xx:重定向-要完成请求必须进行更进一步的操作
- 4xx:客户端错误-请求有语法错误或请求无法实现
- 5xx:服务器错误-服务器未能实现合法的请求

- 200 OK:客户端请求成功
- 206 : 客户发送一个带有Range头的GET请求，服务器完成了他
- 301 : 所请求的页面已经转移至新的url
- 302 : 锁清秋的页面已经临时转移至新的url
- 304 : 客户端有缓冲的文档并发出一个条件性的请求，服务器告诉客户，原来缓冲的文档还可以继续使用
- 403 : 对被请求页面的访问被禁止
- 404 : 请求资源不存在
- 500 : 服务器发生不可预期的错误
- 503 : 请求未完成，服务器临时过载或当机，一段时间后可能恢复正常

---
# http协议类
## 持久连接
- http协议采用'请求-应答'模式，当使用普通模式，即非keep-Alive模式时，每个请求/应答客户端和服务端都要新建一个连接，完成之后立即断开连接（http协议为无连接的协议 
- 当使用Keep-Alive模式(持久连接，连接重用)时，keep-Alive功能使客户端到服务器端的连接持续有效，当出现对服务器的后继请求时，keep-Alive功能避免了建立或者重新建立连接

## 管线化
- 在持久连接情况下，某个连接上消息的传递类似于 请求1 -> 响应1 -> 请求2 -> 响应2 -> 请求3 -> 响应3
- 管线化就是在某个连接上的消息变成类似这样： 请求1 -> 请求2 -> 请求3 -> 响应1 -> 响应2 -> 响应3

###管线化的特点
- 管线化机制只有通过持久连接完成仅http1.1支持此技术 
- 只有get和head请求可以管线化，post有所限制
- 初次创建连接时不应启动管线机制，因为对方服务器不一定支持http1.1版本的协议