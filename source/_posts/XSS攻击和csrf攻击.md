title: XSS攻击和csrf攻击
---
# XSS攻击和csrf攻击
## XSS(Cross Site Script)
- 跨站脚本攻击：向网页中注入恶意脚本在用户浏览网页时执行恶意脚本的攻击方式
 + 反射弧攻击：[经过后端，不经过数据库]诱使用户点击一个嵌入恶意脚本的连接达到攻击的目标
 + 持久型攻击：[经过后端，经过数据库]将恶意脚本提交到被攻击网站的数据库中，用户浏览网页时，恶意脚本从数据库中被加载到页面执行
 + DOM：[不经过后端] dom-xss通过url传入参数去控制触发

### 防范XSS攻击 
- 编码，转义用户输入，把用户的输入解读为数据而不是代码
	+ 对用户输入的数据进行HTML Entity编码 < 的编码是 &lt;
- 过滤：校验度，对用户的输入及请求进行过滤检查，对特殊字符串进行过滤，设置输入域的匹配规则
	+ 移除用户上传的DOM属性，如onerror等
	+ 移除用户上传的style节点，script节点 ，iframe节点

- 校正 ：避免直接对HTML Entity编码,使用DOM Parse转换，校正不匹配对的DOM标签
- 对于持久性和反射型攻击，福区段验证是必须的
- 对于基于DOM的XSS攻击，验证输入在客户端必须执行
- [防御XSS的七条原则](http://www.freebuf.com/articles/web/9977.html)

 ---

## CSRF攻击(Cross Site Request Forgery)
 - 跨站请求伪造：攻击者通过跨站请求，以合法的用户身份进行非法操作
 - 主要原理是利用浏览器的Cookie或服务器的Session盗取用户身份

### 防范CSRF的主要手段是：识别请求者身份
 - 1.在表单中添加令牌（token)
 - 2.验证码[用户体验糟糕--在短时间内多次提交一个表单而未获得成功后可以要求提供验证码，比较好的用户体验]
 - 3.检查请求头中的Referer(应用：防图片盗连接)

 ---

## SQL注入攻击
 - SQL注入是一种将SQL代码添加到输入参数中，传递到SQL服务器解析并执行的一种攻击手法
 - SQL注入的产生
 	+ web开发人员无法保证所有的输入都已经过滤
 	+ 攻击者利用发送给SQL服务器的输入数据构造可执行的SQL代码
 	+ 数据库未做相应的安全配置

 - SQL的数字注入：使得sql查询条件为真
 - SQL字符串注入：sql语句的(#)或是(--)后面都会被当成注释，所以只要用单引号或双引号，闭合前面的sql语句即可

 - 如何预防SQL注入：
  + 严格检查输入变量的类型和格式：检查id是否为空或是不合法，正则校验 
  + 过滤和转义特殊字符：addslahes(username)或mysqli_real_escape_string()对单引号，双引号进行转义
  + 利用mysql的预编译机制
  